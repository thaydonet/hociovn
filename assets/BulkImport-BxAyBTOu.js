import{u as V,j as e,q as A,a as R,b as H}from"./index-1I7WcIle.js";import{u as G,r as l,R as L}from"./router-CAYE_5iO.js";import"./vendor-CjZsb-BP.js";const W=v=>{const g=[],d=v.split(/\r?\n/).map(c=>c.trim());let i=null,o="question",u="",h="",r={},p=[],n="mcq",b=!1;for(let c=0;c<d.length;c++){const a=d[c];if(!a)continue;if(a.match(/^MCQ\s*$/i)){n="mcq";continue}if(a.match(/^MSQ\s*$/i)){n="msq";continue}if(a.match(/^SA\s*$/i)){n="sa";continue}const f=a.match(/^C√¢u\s*(\d+):\s*(.+)$/i);if(f){if(i&&u){const y=b?n:"sa";g.push({type:y,question_text:u.trim(),option_a:r.A||r.a||"",option_b:r.B||r.b||"",option_c:r.C||r.c||"",option_d:r.D||r.d||"",correct_option:y==="sa"?p.join(","):p.join(",").toUpperCase(),explanation:h.trim()})}i={type:n},u=f[2],h="",r={},p=[],b=!1,o="question";continue}const x=a.match(/^([*]?)([A-Da-d])[.)]\s*(.+)$/);if(x){b=!0;const y=x[1]==="*",q=x[2].toUpperCase(),$=x[3].trim(),N=q;r[N]=$,y&&p.push(N),o="options";continue}if(a.match(/^L·ªùi gi·∫£i|^Gi·∫£i th√≠ch/i)){o="explanation";const y=a.replace(/^L·ªùi gi·∫£i|^Gi·∫£i th√≠ch/i,"").trim();y&&(h=y);continue}const w=a.match(/^ƒê√°p √°n:\s*(.+)$/i);if(w){p=[w[1].trim()],b||(n="sa");continue}o==="question"&&u?u+=" "+a:o==="explanation"&&(a.match(/^ƒê√°p √°n:/i)||(h+=(h?" ":"")+a))}if(i&&u){const c=b?n:"sa";g.push({type:c,question_text:u.trim(),option_a:r.A||r.a||"",option_b:r.B||r.b||"",option_c:r.C||r.c||"",option_d:r.D||r.d||"",correct_option:c==="sa"?p.join(","):p.join(",").toUpperCase(),explanation:h.trim()})}return g},Y=v=>{const g=v.trim();if(!g)return[];try{const d=JSON.parse(g);if(Array.isArray(d))return d.map(i=>({type:i.type||"mcq",question_text:i.question||i.question_text||"",option_a:i.option_a||"",option_b:i.option_b||"",option_c:i.option_c||"",option_d:i.option_d||"",correct_option:i.correct_option||"",explanation:i.explanation||""}));if(d.questions&&Array.isArray(d.questions))return d.questions.map(i=>({type:i.type||"mcq",question_text:i.question||i.question_text||"",option_a:i.option_a||"",option_b:i.option_b||"",option_c:i.option_c||"",option_d:i.option_d||"",correct_option:i.correct_option||"",explanation:i.explanation||""}))}catch{}return W(g)},se=()=>{const{user:v}=V(),g=G(),[d,i]=l.useState(""),[o,u]=l.useState(null),[h,r]=l.useState(!1),[p,n]=l.useState(null),[b,c]=l.useState(null),[a,f]=l.useState(0),[x,w]=l.useState(""),[y,q]=l.useState([]),[$,N]=l.useState([]),[I,k]=l.useState([]),[z,j]=l.useState([]),[_,D]=l.useState(0),[C,B]=l.useState(0),[S,J]=l.useState(0),[M,T]=l.useState(!1),[Q,E]=l.useState("");L.useEffect(()=>{(async()=>{try{const s=await A.getSubjects();q(s)}catch(s){console.error("Error loading subjects:",s)}})()},[]),L.useEffect(()=>{(async()=>{if(_===0){N([]),k([]),j([]);return}try{const s=await A.getChaptersBySubject(_);N(s),k([]),j([])}catch(s){console.error("Error loading chapters:",s)}})()},[_]),L.useEffect(()=>{(async()=>{if(C===0){k([]),j([]);return}try{const s=await A.getLessonsByChapter(C);k(s),j([])}catch(s){console.error("Error loading lessons:",s)}})()},[C]),L.useEffect(()=>{(async()=>{if(S===0){j([]);return}try{const s=await A.getQuestionTypesByLesson(S);j(s)}catch(s){console.error("Error loading question types:",s)}})()},[S]);const U=()=>{try{const t=Y(d);if(t.length===0){n("Kh√¥ng t√¨m th·∫•y c√¢u h·ªèi n√†o. Vui l√≤ng ki·ªÉm tra ƒë·ªãnh d·∫°ng file."),u(null);return}u(t),n(`‚úÖ ƒê√£ ph√¢n t√≠ch ${t.length} c√¢u h·ªèi th√†nh c√¥ng!`),c(null)}catch(t){u(null),n("‚ùå L·ªói: Kh√¥ng th·ªÉ ph√¢n t√≠ch ƒë·∫ßu v√†o. Vui l√≤ng ki·ªÉm tra ƒë·ªãnh d·∫°ng."),console.error("Parse error:",t)}},K=t=>{const s=t.target.files?.[0];if(!s)return;const m=new FileReader;m.onload=O=>{const F=O.target?.result;i(F),n('ƒê√£ t·∫£i file. Nh·∫•n "Ph√¢n t√≠ch" ƒë·ªÉ xem k·∫øt qu·∫£.')},m.readAsText(s,"UTF-8")},P=async()=>{if(!o||o.length===0){n("Kh√¥ng c√≥ c√¢u h·ªèi n√†o ƒë·ªÉ import");return}if(!a||a===0){n("Vui l√≤ng ch·ªçn D·∫°ng b√†i tr∆∞·ªõc khi import");return}r(!0),n(null);try{const t=o.map(s=>({question_type_id:a,type:s.type,question_text:s.question_text,option_a:s.option_a,option_b:s.option_b,option_c:s.option_c,option_d:s.option_d,correct_option:s.correct_option,explanation:s.explanation,difficulty:"medium",tags:[]}));await R.bulkCreateQuestions(t),n(`‚úÖ ƒê√£ import ${t.length} c√¢u h·ªèi v√†o ng√¢n h√†ng th√†nh c√¥ng!`),u(null),i(""),c(null)}catch(t){console.error("Bulk import error",t),n("‚ùå L·ªói khi import: "+(t?.message||String(t)))}finally{r(!1)}},X=async()=>{if(!o||o.length===0){n("Kh√¥ng c√≥ c√¢u h·ªèi n√†o ƒë·ªÉ t·∫°o ƒë·ªÅ thi");return}if(!x.trim()){n("Vui l√≤ng nh·∫≠p t√™n ƒë·ªÅ thi");return}if(!v){n("B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p ƒë·ªÉ t·∫°o ƒë·ªÅ thi online");return}r(!0),n(null);try{const t=o.map((m,O)=>({id:`import_${O}`,type:m.type,question:m.question_text,option_a:m.option_a||"",option_b:m.option_b||"",option_c:m.option_c||"",option_d:m.option_d||"",correct_option:m.correct_option,explanation:m.explanation||"",difficulty:"medium",created_at:new Date().toISOString()})),s=await H.createQuiz({title:x.trim(),questions:t,time_limit_minutes:void 0,max_attempts:1,shuffle_questions:!1,shuffle_options:!1,show_results_after_submission:!0,show_correct_answers:!0,password:void 0,status:"published",is_public:!0});n(`‚úÖ ƒê√£ t·∫°o ƒë·ªÅ thi "${x}" th√†nh c√¥ng! ƒêang chuy·ªÉn h∆∞·ªõng...`),setTimeout(()=>{g(`/online-exam/${s.slug}`)},1500)}catch(t){console.error("Error creating quiz:",t),n("‚ùå L·ªói khi t·∫°o ƒë·ªÅ thi: "+(t?.message||String(t)))}finally{r(!1)}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Upload file TXT ho·∫∑c d√°n n·ªôi dung"}),e.jsx("input",{type:"file",accept:".txt,.json",onChange:K,className:`mb-2 text-sm text-gray-500
            file:mr-4 file:py-2 file:px-4
            file:rounded-md file:border-0
            file:text-sm file:font-semibold
            file:bg-blue-50 file:text-blue-700
            hover:file:bg-blue-100`}),e.jsx("textarea",{value:d,onChange:t=>i(t.target.value),placeholder:"D√°n n·ªôi dung file TXT ho·∫∑c JSON ·ªü ƒë√¢y...",rows:12,className:"w-full p-3 border border-gray-300 rounded-md font-mono text-sm"}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500 space-y-1",children:[e.jsxs("div",{children:["üí° ",e.jsx("strong",{children:"Format TXT:"})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"MCQ/MSQ:"})," C√¢u X: ... *A. ... B. ... C. ... D. ... L·ªùi gi·∫£i ..."]}),e.jsxs("div",{children:[e.jsx("strong",{children:"SA (c√≥ ƒë√°p √°n):"})," C√¢u X: ... L·ªùi gi·∫£i ƒê√°p √°n: ... N·ªôi dung l·ªùi gi·∫£i"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Auto-detect:"})," C√¢u h·ªèi kh√¥ng c√≥ A,B,C,D s·∫Ω t·ª± ƒë·ªông chuy·ªÉn th√†nh SA"]})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{onClick:U,disabled:!d.trim()||h,className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 disabled:opacity-50",children:"Ph√¢n t√≠ch"})}),p&&e.jsx("div",{className:`p-3 rounded-md ${p.startsWith("‚úÖ")?"bg-green-50 text-green-700":p.startsWith("‚ùå")?"bg-red-50 text-red-700":"bg-gray-100 text-gray-700"}`,children:p}),o&&o.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"font-semibold",children:["üìÑ JSON ƒë√£ ph√¢n t√≠ch (",o.length," c√¢u h·ªèi)"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(JSON.stringify(o,null,2)),n("‚úÖ ƒê√£ copy JSON v√†o clipboard!"),setTimeout(()=>n(null),2e3)},className:"px-3 py-1 bg-gray-100 text-gray-700 rounded text-sm hover:bg-gray-200",children:"üìã Copy"}),e.jsx("button",{onClick:()=>{E(JSON.stringify(o,null,2)),T(!0)},className:"px-3 py-1 bg-blue-100 text-blue-700 rounded text-sm hover:bg-blue-200",children:"‚úèÔ∏è Ch·ªânh s·ª≠a"})]})]}),e.jsx("div",{className:"bg-gray-50 border rounded p-3 max-h-80 overflow-auto",children:e.jsx("pre",{className:"text-xs font-mono text-gray-800 whitespace-pre-wrap",children:JSON.stringify(o,null,2)})}),e.jsx("div",{className:"mt-2 text-xs text-gray-500",children:"üí° Ki·ªÉm tra JSON tr∆∞·ªõc khi import. B·∫°n c√≥ th·ªÉ copy v√† ch·ªânh s·ª≠a n·∫øu c·∫ßn."})]}),e.jsxs("div",{className:"bg-white border rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"üëÅÔ∏è Xem tr∆∞·ªõc c√¢u h·ªèi"}),e.jsxs("div",{className:"space-y-3 max-h-64 overflow-auto",children:[o.slice(0,3).map((t,s)=>e.jsxs("div",{className:"p-3 border rounded bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${t.type==="mcq"?"bg-blue-100 text-blue-800":t.type==="msq"?"bg-purple-100 text-purple-800":"bg-green-100 text-green-800"}`,children:t.type.toUpperCase()}),e.jsxs("span",{className:"text-xs text-gray-500",children:["C√¢u ",s+1]})]}),e.jsx("div",{className:"font-medium mb-2",children:t.question_text}),t.type!=="sa"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-1 text-sm",children:[t.option_a&&e.jsxs("div",{className:`p-1 rounded ${t.correct_option.includes("A")?"bg-green-100 text-green-800":""}`,children:["A. ",t.option_a]}),t.option_b&&e.jsxs("div",{className:`p-1 rounded ${t.correct_option.includes("B")?"bg-green-100 text-green-800":""}`,children:["B. ",t.option_b]}),t.option_c&&e.jsxs("div",{className:`p-1 rounded ${t.correct_option.includes("C")?"bg-green-100 text-green-800":""}`,children:["C. ",t.option_c]}),t.option_d&&e.jsxs("div",{className:`p-1 rounded ${t.correct_option.includes("D")?"bg-green-100 text-green-800":""}`,children:["D. ",t.option_d]})]}),e.jsxs("div",{className:"mt-2 text-xs",children:[e.jsxs("span",{className:"font-semibold text-green-700",children:["ƒê√°p √°n: ",t.correct_option]}),t.explanation&&e.jsxs("div",{className:"mt-1 text-gray-600",children:[e.jsx("span",{className:"font-semibold",children:"L·ªùi gi·∫£i:"})," ",t.explanation.substring(0,100),t.explanation.length>100&&"..."]})]})]},s)),o.length>3&&e.jsxs("div",{className:"text-xs text-gray-500 text-center py-2 border-t",children:["... v√† ",o.length-3," c√¢u h·ªèi kh√°c"]})]})]}),!b&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-3",children:"Ch·ªçn h√†nh ƒë·ªông:"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>c("bank"),className:"p-4 bg-white border-2 border-blue-300 rounded-lg hover:border-blue-500 hover:shadow-md transition-all text-left",children:[e.jsx("div",{className:"font-semibold text-blue-900 mb-1",children:"üìö Import v√†o ng√¢n h√†ng c√¢u h·ªèi"}),e.jsx("div",{className:"text-sm text-gray-600",children:"L∆∞u c√¢u h·ªèi v√†o ng√¢n h√†ng ƒë·ªÉ s·ª≠ d·ª•ng sau"})]}),e.jsxs("button",{onClick:()=>c("quiz"),className:"p-4 bg-white border-2 border-green-300 rounded-lg hover:border-green-500 hover:shadow-md transition-all text-left",children:[e.jsx("div",{className:"font-semibold text-green-900 mb-1",children:"üìù T·∫°o ƒë·ªÅ thi online"}),e.jsx("div",{className:"text-sm text-gray-600",children:"T·∫°o ƒë·ªÅ thi ngay ƒë·ªÉ h·ªçc sinh l√†m b√†i"})]})]})]}),b==="bank"&&e.jsxs("div",{className:"bg-white border-2 border-blue-300 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-4",children:"üìö Import v√†o ng√¢n h√†ng c√¢u h·ªèi"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"M√¥n h·ªçc *"}),e.jsxs("select",{value:_,onChange:t=>{D(Number(t.target.value)||0),B(0),J(0),f(0)},className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm",required:!0,children:[e.jsx("option",{value:"0",children:"-- Ch·ªçn m√¥n h·ªçc --"}),y.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ch∆∞∆°ng *"}),e.jsxs("select",{value:C,onChange:t=>{B(Number(t.target.value)||0),J(0),f(0)},className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm",disabled:_===0,required:!0,children:[e.jsx("option",{value:"0",children:"-- Ch·ªçn ch∆∞∆°ng --"}),$.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"B√†i h·ªçc *"}),e.jsxs("select",{value:S,onChange:t=>{J(Number(t.target.value)||0),f(0)},className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm",disabled:C===0,required:!0,children:[e.jsx("option",{value:"0",children:"-- Ch·ªçn b√†i h·ªçc --"}),I.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"D·∫°ng b√†i *"}),e.jsxs("select",{value:a,onChange:t=>f(Number(t.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm",disabled:S===0,required:!0,children:[e.jsx("option",{value:"0",children:"-- Ch·ªçn d·∫°ng b√†i --"}),z.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:P,disabled:h||!a,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50",children:h?"ƒêang import...":`Import ${o.length} c√¢u h·ªèi`}),e.jsx("button",{onClick:()=>c(null),className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400",children:"H·ªßy"})]})]}),b==="quiz"&&e.jsxs("div",{className:"bg-white border-2 border-green-300 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-green-900 mb-4",children:"üìù T·∫°o ƒë·ªÅ thi online"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"T√™n ƒë·ªÅ thi *"}),e.jsx("input",{type:"text",value:x,onChange:t=>w(t.target.value),placeholder:"Nh·∫≠p t√™n ƒë·ªÅ thi...",className:"w-full px-3 py-2 border border-gray-300 rounded-md",required:!0})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:X,disabled:h||!x.trim(),className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50",children:h?"ƒêang t·∫°o...":`T·∫°o ƒë·ªÅ thi v·ªõi ${o.length} c√¢u h·ªèi`}),e.jsx("button",{onClick:()=>c(null),className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400",children:"H·ªßy"})]})]})]}),M&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"‚úèÔ∏è Ch·ªânh s·ª≠a JSON"}),e.jsx("button",{onClick:()=>T(!1),className:"text-gray-500 hover:text-gray-700",children:"‚úï"})]}),e.jsx("div",{className:"flex-1 p-4 overflow-hidden",children:e.jsx("textarea",{value:Q,onChange:t=>E(t.target.value),className:"w-full h-full min-h-[400px] p-3 border border-gray-300 rounded-md font-mono text-sm resize-none",placeholder:"Ch·ªânh s·ª≠a JSON ·ªü ƒë√¢y..."})}),e.jsxs("div",{className:"flex justify-between items-center p-4 border-t bg-gray-50",children:[e.jsx("div",{className:"text-sm text-gray-600",children:'üí° Ch·ªânh s·ª≠a JSON v√† nh·∫•n "√Åp d·ª•ng" ƒë·ªÉ c·∫≠p nh·∫≠t d·ªØ li·ªáu'}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>T(!1),className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400",children:"H·ªßy"}),e.jsx("button",{onClick:()=>{try{const t=JSON.parse(Q);Array.isArray(t)?(u(t),T(!1),n("‚úÖ ƒê√£ c·∫≠p nh·∫≠t JSON th√†nh c√¥ng!"),setTimeout(()=>n(null),3e3)):n("‚ùå JSON ph·∫£i l√† m·ªôt m·∫£ng c√¢u h·ªèi")}catch{n("‚ùå JSON kh√¥ng h·ª£p l·ªá. Vui l√≤ng ki·ªÉm tra c√∫ ph√°p.")}},className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"√Åp d·ª•ng"})]})]})]})})]})};export{se as default};
